---
title: "Vulnerability Management Home Lab"
date: "02-17-2022"
author: "Reda BELHAJ"
summary: "In this post, I’m going to do a Vulnerability Management Lab Where I set up a Winodws 10 inside a VM, install an old depricated Firefox and I’m gonna do a Vulnerability scan against the Virtual machine."
tags: ["Homelab", "Nessus", "Vulnerabilitymanagement"]
image: "/images/VulnLab/bg.png"
---

## Introduction
In this post, I'm going to do a **Vulnerability Management Lab** Where I set up a Winodws 10 inside a VM, install an old depricated Firefox and I'm gonna do a Vulnerability scan against the Virtual machine. So the ingredients that we will need:

- [VirtualBox](https://www.virtualbox.org/wiki/Downloads) or [VmWare Player](https://customerconnect.vmware.com/en/downloads/info/slug/desktop_end_user_computing/vmware_workstation_player/16_0)
- [Winodws 10 ISO](https://vercel.com/home)
- [Nessus Essentials](https://www.tenable.com/products/nessus/nessus-essentials)

### What is a Vulnerability management
First *What is a Vulnerability management ?* **Vulnerability management** is the process of identifying, evaluating, treating, and reporting on security vulnerabilities in systems and the software that runs on them. This, implemented alongside with other security tactics, is vital for organizations to prioritize possible threats and minimizing their `attack surface.`

## Ensure The connectivity with the VM
After Installing Nessus Essentials and setting up Winodws 10 inside the VM. I decided to test The connectivity with the VM;
![IPconfig](/images/VulnLab/ipconfig.JPG)

![pingTimeOut](/images/VulnLab/pingTimeOut.JPG)

As We See the request timed out. So we have to diseable **the firewall** in the VM by using `Microsoft Common Console Document` or `wf.msc`.
![FirewallOff1](/images/VulnLab/FirewallOff1.JPG)
![FirewallOff2](/images/VulnLab/FirewallOff2.JPG)
![FirewallOff3](/images/VulnLab/FirewallOff3.JPG)

And now We can notice that the ping is going through the VM.
![pingSuccess](/images/VulnLab/pingSuccess.JPG)

## Basic Network Scan without Credentials
First I tried a Basic Network Scan on the Virtual machine that is connected with a **network bridge** But it didn't work.
![CreateScanBasic](/images/VulnLab/CreateScanBasic.JPG)

And After some troubleshooting and research. I learned that Nesus have some trouble discovering bridged connected VMs and I've decided to switch to Host Only that's used to create a network containing a host without the need for the host's physical network interface. Instead, a virtual network interface.
![TroubleShotHostOnly](/images/VulnLab/TroubleShotHostOnly.JPG)

After A few minutes The scan has finished:
![resultNoCredentials](/images/VulnLab/resultNoCredentials.JPG)
![Vulnerability1](/images/VulnLab/Vulnerability1.JPG)

So We found `1` Medium vulnerability and `30` INFO vulnerabilities:

- **SMB Signing not required:** Means that an unauthenticated, remote attacker can exploit this to conduct man-in-the-middle attacks against the SMB server. [See Solution](https://www.tenable.com/plugins/nessus/57608)
- **INFO** is not intended to be a vulnerability. It is simply stating a fact like a Detection an Identification etc...

## Basic Network Scan with Credentials
To do a credential scan we have to enable the **Remote Registry** which will allow the scanner to connect to the VM and look for insecure configurations.
![RemoteRegistry](/images/VulnLab/RemoteRegistry.JPG)

And Next we're going to enable **file and printer sharing**:
![shareAdv](/images/VulnLab/shareAdv.JPG)

Then I diseable the notifications under the **User Account Control Setting**:
![ControlAccount](/images/VulnLab/ControlAccount.JPG)

Last We'll need to add a `DWORD` called **LocalAccountTokenFilterPolicy** inside the registry editor and we have to restart the VM:
![RegEditorCreateDWORD](/images/VulnLab/RegEditorCreateDWORD.JPG)
![SetDWORD](/images/VulnLab/SetDWORD.JPG)

And Now we can create the Basic Network Scan with Credentials that you configured when you setup the VM:
![CreateScanWithCred1](/images/VulnLab/CreateScanWithCred1.JPG)
![CreateScanWithCred2](/images/VulnLab/CreateScanWithCred2.JPG)

After A few minutes The scan has finished:
![ResultCredentials](/images/VulnLab/ResultCredentials.JPG)
![Vulnerability2](/images/VulnLab/Vulnerability2.JPG)

So We found `2` Critical, `11` Highs, `3` Mediums, `147` INFO vulnerabilities for example:

- **CRITICAL KB5008212:** that indicates that The remote Windows host is missing security update 5008212.
- **HIGH Microsoft Windows VP9 Video Extensions Library RCE:** The Windows 'VP9 Extensions' app installed on the remote host is affected by a remote code execution vulnerability.

## Basic Network Scan After Installing a Depricated Firefox version
So I found this [Depricated Firefox version](https://ftp.mozilla.org/pub/firefox/releases/3.6.12/win32/en-US/) and I've installed it in my VM.
![OldVersionFirefox](/images/VulnLab/OldVersionFirefox.JPG)

And Now we can create the Scan
![CreateScanFirefox](/images/VulnLab/CreateScanFirefox.JPG)

After A few minutes The scan has finished:
![ResultFireFoxOld](/images/VulnLab/ResultFireFoxOld.JPG)
![Vulnerability3](/images/VulnLab/Vulnerability3.JPG)

So We found `61` Critical, `77` Highs, `19` Mediums, `156` INFO vulnerabilities for example:

- **CRITICAL Firefox < 14.0 Multiple Vulnerabilities:** that indicates that The installed version of Firefox is earlier than 14.0 and thus.
- **HIGH Microsoft Windows Defender Elevation of Privilege Vulnerability (CVE-2020-1163 & CVE-2020-1170):** The version of Microsoft Windows Defender component MpCmdRun.exe installed on the remote Windows host is prior to 4.18.2005.1.

## Basic Network Scan After Remediating some Vulnerabilities.
So We're gonna try to remediate some Vulnerabilities. First we **Uninstall** deprecated Firefox:
![UninstallFirefox](/images/VulnLab/UninstallFirefox.JPG)

Then we update Windows:
![WinUpdate2](/images/VulnLab/WinUpdate2.JPG)
![UptoDate](/images/VulnLab/UptoDate.JPG)

And Now we can create the Scan
![CreateScanAfterRemed](/images/VulnLab/CreateScanAfterRemed.JPG)

After A few minutes The scan has finished:
![ResultAfterRemd](/images/VulnLab/ResultAfterRemd.JPG)
![Vulnerability4](/images/VulnLab/Vulnerability4.JPG)

So We found `8` Highs, `3` Mediums, `152` INFO vulnerabilities for example:

- **HIGH Microsoft Windows Web Media Extensions Library RCE:** The Windows 'Web Media Extensions' app installed on the remote host is affected by a remote code execution vulnerability.
- **MEDIUM Microsoft Paint 3D Multiple Vulnerabilities:** The Windows 'Paint 3D' app installed on the remote host is affected by multiple remote code execution vulnerabilities.
